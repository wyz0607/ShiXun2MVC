@model Restaurant_Information_MVC.Models.UserInfo
    @using Restaurant_Information_MVC.Controllers
@{
    ViewBag.Title = "Uptuser";
}
@*<script src="~/Scripts/jquery-3.3.1.js"></script>*@
<link href="~/layui/css/layui.css" rel="stylesheet" />
<script src="~/layui/layui.js"></script>

<div>

    <input id="Hidden1" type="hidden" value="@Model.UserID" />
    <input id="Username" type="hidden" value="@Model.UserName" />
    <input id="Userphone" type="hidden" value="@Model.UserPhone" />
    <input id="Usersex" type="hidden" value="@Model.UserSex" />
    <input id="Userrole" type="hidden" value="@Model.Role" />
    <input id="Privilege" type="hidden" value="@Model.Privilege" />
    <input id="Userpwd" type="hidden" value="@Model.UserPwd" />
   

    
 
    <input id="yan" type="hidden"  />
    <table class="table-hover" style=" width:600px;height:350px;margin-left:200px;">
        <tr>
            <td>原密码</td>
            <td><input id="Text1" type="password" onchange="Txt()" /></td>
            <td> <label id="lab1" style="color:red"></label></td>
            <td></td>
        </tr>
        <tr>
            <td>修改后密码</td>
            <td><input id="Gaipwd" type="password" /></td>
        </tr>
        <tr>
            <td>确认密码</td>
            <td><input id="Quepwd" type="password" onchange="que()" /></td>
            <td>
                <label id="lab" style="color:red"></label>
            </td>
            <td></td>
        </tr>
        <tr>
            <td>邮箱</td>
            <td><input id="Phone" type="text" @*onchange="Iphone()"*@ /></td>
            <td><input id="btnyan" class="layui-btn layui-btn-normal" type="button" name="yzm" value="获取验证码" /></td>
            <td>
                <label id="phoneremark" style="color:red"></label>
            </td>
        </tr>
        <tr>
            <td>验证码</td>
            <td><input id="Yan1" type="text" /></td>
            <td>
                <label id="yanzheng" style="color:red"></label>
            </td>
        </tr>
        <tr>
            <td></td>
            <td>
                <input id="Button1" class="layui-btn layui-btn-radius" type="button" value="修改" onclick="Upt(@Model.UserID)" />
                <input id="Button1" class="layui-btn layui-btn-radius" type="button" value="取消" onclick="Fan()" />
            </td>
        </tr>
        <tr>
            <td><label id="tishi" style="color:red"></label></td>
        </tr>
    </table>
</div>
<script>
    function Txt() {
        if ($("#Text1").val() != $("#Userpwd").val()) {
            $("#lab1").text("输入的密码错误");
            return;
        }
        else {
            $("#lab1").hide();
        }
    }

    function que() {
        if ($("#Gaipwd").val() != $("#Quepwd").val()) {
            $("#lab").text("两次密码不一样");
            return;
        }
        else {
            $("#lab").hide();
        }
    }



    //function Iphone() {
    //    if ($("#Phone").val() != $("#Userphone").val()) {
    //        $("#phoneremark").text("输入的手机号与预存的手机号不一致")
    //        return;
    //    }
    //    else {
    //        $("#phoneremark").hide();
    //    }
    //}

    function Upt(id) {
        if ($("#Text1").val() == null || $("#Phone").val() == null || $("#Yan1").val() == null || $("#Phone").val() == null) {
            $("#tishi").text("上述信息不完整");
            return;
        }
        else {
            $("#tishi").hide();
        }
        if ($("#Text1").val() != $("#Userpwd").val()) {
            $("#lab1").text("输入的密码错误");
            return;
        }
        else {
            $("#lab1").hide();
        }
        if ($("#Gaipwd").val() != $("#Quepwd").val()) {
            $("#lab").text("两次密码不一样");
            return;
        }
        else {
            $("#lab").hide();
        }
        //if ($("#Phone").val() != $("#Userphone").val()) {
        //    $("#phoneremark").text("输入的手机号与预存的手机号不一致")
        //    return;
        //}
        //else {
        //    $("#phoneremark").hide();
        //}
       
        if ($("#Yan1").val().toString() != $("#yan").val().toString()) {
            $("#yanzheng").text("验证码错误");
            return;
        }
        else {
            $("#yanzheng").hide();
        }

        var o = {
            UserId: id,
            UserName: $("#Username").val(),
            UserPhone: $("#Phone").val().trim(),
            UserSex: $("#Usersex").val(),
            UserPwd: $("#Gaipwd").val().trim(),
            Role: $("#Userrole").val(),
            Privilege: $("#Privilege").val()
        }
        layui.use('layer', function () {
            layer.confirm("确认修改？", {
                btn: ['确定', '取消']
                , yes: function (index, layero) {
                    $.ajax({
                        url: "/Work/Uptuser",
                        data: { userInfo: o },
                        type: "post",
                        success: function (data) {
                            layer.alert("修改成功");
                            location.href = "/Login/Index";

                        }
                    })
                }, btn2: function (index) { }
            })

        })

    }
    function Fan() {
        //$("#Text1").val().empty;
        //$("#Gaipwd").val().empty();
        //$("#Quepwd").val().empty();
        //$("#Phone").val().empty();
        //$("#Yan").val().empty();
        location.reload();
    }
    var ordertime = 60   //设置再次发送验证码等待时间
    var timeleft = ordertime
    var btn = $(".yzm")
    var phone = $(".phone")
    var reg = /^1[0-9]{10}$/;  //电话号码的正则匹配式

    //phone.keyup(function () {
    //    if (reg.test(phone.val())) {
    //        $("#btnyan").removeAttr("disabled")  //当号码符合规则后发送验证码按钮可点击
    //    }
    //    else {
    //        $("#btnyan").attr("disabled", true)
    //    }
    //})

    //计时函数
    function timeCount() {
        timeleft -= 1
        if (timeleft > 0) {
            $("#btnyan").val(timeleft + " 秒后重发");
            setTimeout(timeCount, 1000)
            $("#btnyan").attr("disabled", true);
        }
        else {
            $("#btnyan").val("重新发送");
            timeleft = ordertime   //重置等待时间
            $("#btnyan").removeAttr("disabled", true);
        }
    }
    //事件处理函数
    $("#btnyan").click(function () {
        var dianhua = $("#Phone").val();

        layui.use('layer', function () {
            $.ajax({
                url: "/Work/SendEmail/?email=" + dianhua,
                type: "get",
                success: function (data) {
                    
                    if (data != null) {
                        $(this).attr("disabled", true); //防止多次点击
                        $("#yan").val(data);
                        //此处可添加 ajax请求 向后台发送 获取验证码请求
                        timeCount(this);
                    }
                    else {

                    }
                  
                }

            })
        })
    })
        //$("#btnyan").click(function () {
        //    var dianhua = $("#Phone").val();

        //    alert(dianhua);
        //    $.ajax({
        //    url: "/Work/SendEmail?email=" + dianhua,
        //    type: "get",
        //    success: function (data) {
        //        alert(data);
        //        if (data == "success") {

        //        }
        //        else {

        //        }
        //        $(this).attr("disabled", true); //防止多次点击
        //        此处可添加 ajax请求 向后台发送 获取验证码请求
        //        timeCount(this);
        //    }

        //})
        //})









</script>



